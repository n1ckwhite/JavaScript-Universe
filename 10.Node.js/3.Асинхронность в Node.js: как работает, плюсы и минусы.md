# ‚ùì –ö–∞–∫ Node.js –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: –º–æ–¥–µ–ª—å, –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã

**Node.js** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–π–Ω—ã–π —Ü–∏–∫–ª (Event Loop) –∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤–≤–æ–¥‚Äë–≤—ã–≤–æ–¥ (Non‚Äëblocking I/O). –ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–º, –∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Ä—É—á–∞—é—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–º API/–ø—É–ª—É, –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è–º–∏/–∫–æ–ª–±—ç–∫–∞–º–∏/–ø—Ä–æ–º–∏—Å–∞–º–∏.

---

## üîπ –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –≤ Node.js

### üìå –°–æ–±—ã—Ç–∏–π–Ω—ã–π —Ü–∏–∫–ª (Event Loop)
–°–µ—Ä–¥—Ü–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –£–ø—Ä–∞–≤–ª—è–µ—Ç –æ—á–µ—Ä–µ–¥—è–º–∏ macrotasks (—Ç–∞–π–º–µ—Ä—ã, I/O callbacks, setImmediate) –∏ microtasks (Promises). –ü–æ–∫–∞ I/O –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –û–°/–ø—É–ª–µ, –ø–æ—Ç–æ–∫ Node –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è.

### üìå Callback‚Äë—Ñ—É–Ω–∫—Ü–∏–∏
–ë–∞–∑–æ–≤—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

```javascript
const fs = require('fs');
fs.readFile('file.txt', 'utf8', (err, data) => {
  if (err) return console.error(err);
  console.log(data);
});
```

### üìå Promise –∏ async/await
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —É–¥–æ–±–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –±–µ–∑ ¬´–∞–¥–æ–≤ –∫–æ–ª–±—ç–∫–æ–≤¬ª.

```javascript
const fs = require('fs/promises');

// Promise
fs.readFile('file.txt', 'utf8')
  .then(console.log)
  .catch(console.error);

// async/await
(async () => {
  try {
    const data = await fs.readFile('file.txt', 'utf8');
    console.log(data);
  } catch (e) {
    console.error(e);
  }
})();
```

### üìå Worker Threads (–¥–ª—è CPU‚Äë—Ç—è–∂—ë–ª—ã—Ö –∑–∞–¥–∞—á)
–û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å —É–¥–æ–±–Ω–∞ –¥–ª—è I/O, –Ω–æ CPU‚Äë–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ü–∏–∫–ª. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–æ—Ä–∫–µ—Ä—ã.

```javascript
// main.js
const { Worker } = require('node:worker_threads');

function runHeavy(input) {
  return new Promise((resolve, reject) => {
    const worker = new Worker(require.resolve('./worker.js'));
    worker.postMessage(input);
    worker.once('message', resolve);
    worker.once('error', reject);
  });
}

console.time('heavy');
runHeavy(42).then((r) => {
  console.timeEnd('heavy');
  console.log('result:', r);
});
```

```javascript
// worker.js
const { parentPort } = require('node:worker_threads');

parentPort.on('message', (n) => {
  let x = 0;
  for (let i = 0; i < 5e8; i++) x += i * n; // –∏–º–∏—Ç–∞—Ü–∏—è CPU‚Äë–Ω–∞–≥—Ä—É–∑–∫–∏
  parentPort.postMessage(x);
});
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è I/O: –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
- –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤: –Ω–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø–æ—Ç–æ–∫ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å, –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏/–∫–æ–Ω—Ç–µ–∫—Å—Ç‚Äë—Å–≤–∏—Ç—á–µ–π.
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è I/O‚Äë–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á: –ë–î, —Ñ–∞–π–ª—ã, —Å–µ—Ç–∏, –ø—Ä–æ–∫—Å–∏, real‚Äëtime.
- –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä—ã/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ ‚Äî —á–µ—Ä–µ–∑ –≤–æ—Ä–∫–µ—Ä—ã.

---

## ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –∏ –∫–∞–∫ –∏—Ö –Ω–∏–≤–µ–ª–∏—Ä–æ–≤–∞—Ç—å

- Callback hell: –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å —É—Ö—É–¥—à–∞–µ—Ç —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å.
  - –†–µ—à–µ–Ω–∏–µ: Promise, async/await, –∫–æ–º–ø–æ–∑–∏—Ü–∏—è.
- –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å: CPU‚Äë—Ç—è–∂—ë–ª—ã–µ –∑–∞–¥–∞—á–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç Event Loop.
  - –†–µ—à–µ–Ω–∏–µ: `worker_threads`, –æ—á–µ—Ä–µ–¥–∏, –≤—ã–Ω–æ—Å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã.
- CPU‚Äë–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç.
  - –†–µ—à–µ–Ω–∏–µ: –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏/–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.
- –û—Ç–ª–∞–¥–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞: —Ä–∞–∑–æ—Ä–≤–∞–Ω–Ω—ã–µ —Å—Ç–µ–∫–∏.
  - –†–µ—à–µ–Ω–∏–µ: sourcemaps, `--trace-warnings`, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π, APM.

---

## üîß –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

- –ù–µ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ Event Loop —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Ç—è–∂—ë–ª—ã–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏
- –û—Ç–¥–∞–≤–∞–π—Ç–µ I/O —Å—Ç—Ä–∏–º–∞–º–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ backpressure (`.pipe`)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏: `try/catch`, `.catch`, —Å–æ–±—ã—Ç–∏—è `'error'`
- –ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ `unhandledRejection`/`uncaughtException`
- –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∏—Ä—É–π—Ç–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ I/O —á–µ—Ä–µ–∑ `Promise.all`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã/–ø–æ–≤—Ç–æ—Ä—ã/–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–∏ (circuit breaker, rate limiting)

---

## üéØ –ò—Ç–æ–≥

- Node.js –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è Event Loop –∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–º—É I/O
- –î–ª—è CPU‚Äë–Ω–∞–≥—Ä—É–∑–æ–∫ –Ω—É–∂–Ω—ã –≤–æ—Ä–∫–µ—Ä—ã/–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- Promise/async‚Äëawait –¥–µ–ª–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ —á–∏—Ç–∞–µ–º—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º

## üèÜ –ó–ê–î–ê–ß–ò

–ó–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏: `callbacks ‚Üí promises`, `async/await`, `Event Loop`, `worker_threads`

---

### üìå –ó–∞–¥–∞—á–∞ 1: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å callbacks ‚Üí Promise
–ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è c –∫–æ–ª–±—ç–∫–æ–º `readFileCb(path, cb)`. –û–±–µ—Ä–Ω–∏—Ç–µ –≤ `readFileAsync(path): Promise<string>` –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Promise.all` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

–®–∞–≥–∏:
1) –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ –∑–∞–≥–æ—Ç–æ–≤–∫—É —Å–∫—Ä–∏–ø—Ç–∞
```bash
echo "alpha" > a.txt
echo "beta" > b.txt
```

2) –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–±—ë—Ä—Ç–∫—É –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
```javascript
// index.js
const fs = require('fs');

const readFileAsync = (path) => new Promise((resolve, reject) => {
  fs.readFile(path, 'utf8', (err, data) => (err ? reject(err) : resolve(data)));
});

async function main() {
  try {
    const [a, b] = await Promise.all([
      readFileAsync('a.txt'),
      readFileAsync('b.txt')
    ]);
    console.log('a:', a.trim());
    console.log('b:', b.trim());
    console.log('sumLength:', a.length + b.length);
  } catch (e) {
    console.error('read error:', e.message);
  }
}

main();
```

3) –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
```bash
node index.js
```
–û–∂–∏–¥–∞–µ–º–æ: —Å—Ç—Ä–æ–∫–∏ –∏–∑ a/b –∏ —Å—É–º–º–∞ –¥–ª–∏–Ω. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ `a.txt` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è `read error: ...`.

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 2: async/await —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ `config.json`, —Ä–∞—Å–ø–∞—Ä—Å—å—Ç–µ –∏ –≤—ã–≤–µ–¥–∏—Ç–µ –ø–æ–ª–µ `apiUrl`. –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

–®–∞–≥–∏:
1) –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
cat > config.json << 'JSON'
{
  "apiUrl": "https://api.example.com",
  "retries": 3
}
JSON
```

2) –†–µ–∞–ª–∏–∑—É–π—Ç–µ —á—Ç–µ–Ω–∏–µ –∏ –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
```javascript
// read-config.js
const fs = require('fs/promises');

async function loadConfig(path) {
  const raw = await fs.readFile(path, 'utf8');
  try {
    return JSON.parse(raw);
  } catch (e) {
    throw new Error(`invalid json in ${path}: ${e.message}`);
  }
}

(async () => {
  try {
    const cfg = await loadConfig('config.json');
    console.log('apiUrl:', cfg.apiUrl);
  } catch (e) {
    console.error('config error:', e.message);
    process.exitCode = 1;
  }
})();
```

3) –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã
- –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª ‚Äî –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –æ—à–∏–±–∫—É —á—Ç–µ–Ω–∏—è.
- –í—Å—Ç–∞–≤—å—Ç–µ –≤ `config.json` –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON ‚Äî –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ `invalid json ...`.

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 3: –ü–æ–∫–∞–∑–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Ü–∏–∫–ª–∞
–°—Ä–∞–≤–Ω–∏—Ç–µ `pbkdf2Sync` –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `pbkdf2`, –≤—ã–≤–µ–¥–∏—Ç–µ –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ sync –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ü–∏–∫–ª.

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
// blocking.js
const { pbkdf2Sync, pbkdf2 } = require('crypto');

console.time('sync');
pbkdf2Sync('pass', 'salt', 1e5, 64, 'sha512');
console.timeEnd('sync');

console.time('async');
pbkdf2('pass', 'salt', 1e5, 64, 'sha512', () => {
  console.timeEnd('async');
  console.log('async finished');
});

console.log('loop alive (printed before async finishes)');
```

–ó–∞–ø—É—Å–∫:
```bash
node blocking.js
```
–ù–∞–±–ª—é–¥–µ–Ω–∏–µ: sync‚Äë–∑–∞–º–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è. –°–æ–æ–±—â–µ–Ω–∏–µ `loop alive` –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ async‚Äë–≤–∞—Ä–∏–∞–Ω—Ç–∞, –¥–æ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 4: –ò–∑–º–µ—Ä–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É Event Loop
–†–µ–∞–ª–∏–∑—É–π—Ç–µ ¬´tick delay¬ª ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –º–µ—Ä—è–π—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –ø–ª–∞–Ω–æ–≤—ã–º –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º `setTimeout`.

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
// loop-delay.js
const interval = 100;
let next = Date.now() + interval;

setInterval(() => {
  const now = Date.now();
  console.log('delay(ms):', now - next);
  next = now + interval;
}, interval);
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ü–∏–∫–ª –Ω–∞ 200‚Äì300–º—Å) –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Ä–∞—Å—Ç—ë—Ç –∑–∞–¥–µ—Ä–∂–∫–∞.
```javascript
// cpu-spike.js
const start = Date.now();
while (Date.now() - start < 300) {}
console.log('spike done');
```
–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–æ/–ø–æ—Å–ª–µ ¬´—Å–ø–∞–π–∫–∞¬ª.

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 5: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤–æ—Ä–∫–µ—Ä –¥–ª—è CPU‚Äë–∑–∞–¥–∞—á–∏
–í—ã–Ω–µ—Å–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á—ë—Ç–∞ –≤ `worker_threads` –∏ –≤–µ—Ä–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ `message`.

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:
```
project/
  main.js
  worker.js
```

–ö–æ–¥:
```javascript
// main.js
const { Worker } = require('node:worker_threads');

function runHeavy(input) {
  return new Promise((resolve, reject) => {
    const worker = new Worker(require.resolve('./worker.js'));
    worker.postMessage(input);
    worker.once('message', resolve);
    worker.once('error', reject);
  });
}

(async () => {
  console.time('heavy');
  const result = await runHeavy(42);
  console.timeEnd('heavy');
  console.log('result:', result);
})();
```

```javascript
// worker.js
const { parentPort } = require('node:worker_threads');

parentPort.on('message', (n) => {
  let x = 0;
  for (let i = 0; i < 5e8; i++) x += i * n; // –∏–º–∏—Ç–∞—Ü–∏—è —Ç—è–∂—ë–ª–æ–π CPU‚Äë—Ä–∞–±–æ—Ç—ã
  parentPort.postMessage(x);
});
```

–ó–∞–ø—É—Å–∫:
```bash
node main.js
```
–û–∂–∏–¥–∞–µ–º–æ: –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø—Ä–∏ —ç—Ç–æ–º Event Loop –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á.

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 6: –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å I/O‚Äëbound vs CPU‚Äëbound
–î–∞–Ω —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞, —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∑–∞–ø—Ä–æ—Å –∫ –ë–î, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Å–∏–≤–∞ –≤ 10 –º–ª–Ω —ç–ª–µ–º–µ–Ω—Ç–æ–≤). –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ –∏—Ö –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –ø–æ–¥—Ö–æ–¥.

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–¥—Ö–æ–¥—ã:
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ‚Äî I/O‚Äëbound ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–∏–º—ã –∏ backpressure
- –ó–∞–ø—Ä–æ—Å –∫ –ë–î ‚Äî I/O‚Äëbound ‚Üí –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, —Ç–∞–π–º–∞—É—Ç—ã/–ø–æ–≤—Ç–æ—Ä—ã
- –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Äî CPU‚Äëbound ‚Üí –≤–æ—Ä–∫–µ—Ä/–≤—ã–Ω–æ—Å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 10 –º–ª–Ω ‚Äî CPU‚Äëbound ‚Üí –≤–æ—Ä–∫–µ—Ä/–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞/–ø–æ—Ä—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å

–ú–∏–Ω–∏‚Äë–ø—Ä–∏–º–µ—Ä—ã:
```javascript
// –°—Ç—Ä–∏–º–∏–Ω–≥ —Ñ–∞–π–ª–∞ –∫–ª–∏–µ–Ω—Ç—É (–æ—Ç–¥–∞—á–∞ –±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞)
const http = require('http');
const fs = require('fs');

http.createServer((req, res) => {
  if (req.url === '/file') {
    const stream = fs.createReadStream('big.dat');
    stream.on('error', () => res.writeHead(500).end('read error'));
    res.writeHead(200, { 'Content-Type': 'application/octet-stream' });
    stream.pipe(res);
  } else {
    res.writeHead(404).end();
  }
}).listen(3005);
```

```javascript
// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã I/O
await Promise.all([
  fetch('https://example.com/a'),
  fetch('https://example.com/b')
]);
```

</details>

---

üéâ –≠—Ç–∏ –∑–∞–¥–∞—á–∏ –ø–æ–º–æ–≥—É—Ç –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ Node.js, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –ø—Ä–∞–∫—Ç–∏–∫ –µ—ë –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.

---


