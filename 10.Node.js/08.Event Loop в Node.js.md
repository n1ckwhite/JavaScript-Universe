# üìå Event Loop –≤ Node.js

**Event Loop (—Å–æ–±—ã—Ç–∏–π–Ω—ã–π —Ü–∏–∫–ª)** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –≤ Node.js, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Node.js, –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ—Ç–æ—Ä–æ–º—É —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ–π –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á. Event Loop –ø–æ–∑–≤–æ–ª—è–µ—Ç Node.js –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ (I/O) –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

---

## üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Event Loop?

**–°–æ–±—ã—Ç–∏–π–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –æ—á–µ—Ä–µ–¥–∏:** –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–∞–∑–∞—Ö. –ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –∏–º–µ–µ—Ç —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ Event Loop –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ Event Loop –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑–µ –∏–ª–∏ –æ–∂–∏–¥–∞–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.

---

## üîπ –≠—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã Event Loop

Event Loop –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–∑, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á:

### üìå 1. Timers
**–í—ã–ø–æ–ª–Ω—è–µ—Ç `setTimeout` –∏ `setInterval`**, –µ—Å–ª–∏ –∏—Å—Ç–µ–∫ –∏—Ö —Ç–∞–π–º–µ—Ä.
```javascript
// –ü—Ä–∏–º–µ—Ä: setTimeout(() => console.log('timer'), 0)
```

### üìå 2. I/O callbacks
**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—á—Ç–∏ –≤—Å–µ –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã (callback)** –æ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ —Å–µ—Ç–∏, –∫—Ä–æ–º–µ —Ç–µ—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ª–æ–∂–µ–Ω—ã —á–µ—Ä–µ–∑ —Ç–∞–π–º–µ—Ä—ã.

### üìå 3. Idle, prepare
**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ–∞–∑—ã** –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã Event Loop. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∏–∂–∫–æ–º Node.js –∏ —Ä–µ–¥–∫–æ —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

### üìå 4. Poll
**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ–∞–∑–∞**, –≥–¥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ I/O –æ–ø–µ—Ä–∞—Ü–∏–π.
- –ï—Å–ª–∏ –≤ —ç—Ç–æ–π —Ñ–∞–∑–µ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –æ–Ω–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- –ï—Å–ª–∏ –∑–∞–¥–∞—á –Ω–µ—Ç, Event Loop –º–æ–∂–µ—Ç –æ–∂–∏–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è

### üìå 5. Check
**–í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏**, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é `setImmediate`.

### üìå 6. Close callbacks
**–í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã** –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `socket.on('close')`).

**–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–∑ Event Loop –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–æ –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.**

---

## üîπ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã Event Loop

### ‚úç –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä:
```javascript
setTimeout(() => console.log('setTimeout'), 0);
setImmediate(() => console.log('setImmediate'));

console.log('–ù–∞—á–∞–ª–æ');
```

### üìä –í—ã–≤–æ–¥:
```
–ù–∞—á–∞–ª–æ
setImmediate
setTimeout
```

### üìù –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
1. **–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥** (`console.log('–ù–∞—á–∞–ª–æ')`)
2. **–§—É–Ω–∫—Ü–∏–∏ `setTimeout` –∏ `setImmediate` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è** –≤ Event Loop
3. **`setImmediate` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ**, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–∞–∑–µ `check`, –∞ `setTimeout` –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ñ–∞–∑—É `timers`

---

## üîπ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ Event Loop

Node.js –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö), –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é Event Loop —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏.

### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const fs = require('fs');

console.log('–ù–∞—á–∞–ª–æ');

fs.readFile('example.txt', (err, data) => {
    if (err) throw err;
    console.log('–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
});

setTimeout(() => console.log('setTimeout'), 0);
console.log('–ö–æ–Ω–µ—Ü');
```

### üìä –í—ã–≤–æ–¥:
```
–ù–∞—á–∞–ª–æ
–ö–æ–Ω–µ—Ü
setTimeout
–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
```

### üìù –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
1. **–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥** (–ù–∞—á–∞–ª–æ –∏ –ö–æ–Ω–µ—Ü)
2. **`fs.readFile` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å** –Ω–∞ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ—Ç–æ–∫. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ Node.js –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–µ callback –≤ –æ—á–µ—Ä–µ–¥—å `poll`
3. **`setTimeout` –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å `timers`** –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
4. **–ö–æ–≥–¥–∞ –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã**, Event Loop –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

---

## üîπ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ setTimeout –∏ setImmediate

–ï—Å–ª–∏ `setTimeout` —Å –Ω—É–ª–µ–≤–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (0) –∏ `setImmediate` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏–∑–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ callback, –ø–æ—Ä—è–¥–æ–∫ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–∂–µ—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è:

### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const fs = require('fs');

fs.readFile('example.txt', () => {
    setTimeout(() => console.log('setTimeout'), 0);
    setImmediate(() => console.log('setImmediate'));
});
```

### üìä –í—ã–≤–æ–¥:
```
setImmediate
setTimeout
```

### üìù –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
–ö–æ–≥–¥–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `fs.readFile`), `setImmediate` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —Ä–∞–Ω—å—à–µ, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–∑–µ `check`, –∞ `setTimeout` ‚Äî –≤ —Ñ–∞–∑–µ `timers` —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞.

---

## üîπ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Event Loop

### ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å
–ü–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π I/O, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –ø–æ—Ç–æ–∫.

### ‚úÖ –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
–£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É, –∏–∑–±–µ–≥–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º—å—é—Ç–µ–∫—Å–æ–≤ –∏ –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö).

### ‚úÖ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
Node.js –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–¥–∞—á —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.

---

## üîπ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ Event Loop

### ‚ùå –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –∫–æ–¥
–ï—Å–ª–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥, —ç—Ç–æ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ—Å—å Event Loop.

### ‚ùå –ù–µ–ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å –¥–ª—è CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
–ü–æ—Å–∫–æ–ª—å–∫—É Node.js –æ–¥–Ω–æ–ø–æ—Ç–æ—á–µ–Ω, –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á.

---

## üîπ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### üìå –ú–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ (Microtasks)
```javascript
// Promise.then() –∏ process.nextTick() –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏
process.nextTick(() => console.log('nextTick'));
Promise.resolve().then(() => console.log('Promise'));

setTimeout(() => console.log('setTimeout'), 0);
setImmediate(() => console.log('setImmediate'));

console.log('–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥');
```

### üìå –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
1. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥**
2. **`process.nextTick()`**
3. **Promise.then()**
4. **–§–∞–∑—ã Event Loop**

### üìå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Event Loop
```javascript
// ‚ùå –ü–ª–æ—Ö–æ - –±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop
function badFunction() {
    const start = Date.now();
    while (Date.now() - start < 5000) {
        // –î–æ–ª–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    }
}

// ‚úÖ –•–æ—Ä–æ—à–æ - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop
function goodFunction() {
    setImmediate(() => {
        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    });
}
```

---

## üîπ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Event Loop

### üìå –ò–∑–º–µ—Ä–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ Event Loop
```javascript
const { performance, PerformanceObserver } = require('perf_hooks');

const obs = new PerformanceObserver((list) => {
    const entries = list.getEntries();
    entries.forEach((entry) => {
        console.log(`Event Loop –∑–∞–¥–µ—Ä–∂–∫–∞: ${entry.duration}ms`);
    });
});

obs.observe({ entryTypes: ['measure'] });

// –ò–∑–º–µ—Ä—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
setInterval(() => {
    performance.mark('start');
    setImmediate(() => {
        performance.mark('end');
        performance.measure('event-loop-lag', 'start', 'end');
    });
}, 1000);
```

### üìå –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
```javascript
const { performance } = require('perf_hooks');

function monitorEventLoop() {
    const start = performance.now();
    
    setImmediate(() => {
        const duration = performance.now() - start;
        console.log(`Event Loop —Ü–∏–∫–ª: ${duration.toFixed(2)}ms`);
        
        if (duration > 100) {
            console.warn('‚ö†Ô∏è  –í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ Event Loop!');
        }
        
        monitorEventLoop(); // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    });
}

monitorEventLoop();
```

---

## üéØ –ò—Ç–æ–≥

**Event Loop** ‚Äî —ç—Ç–æ —è–¥—Ä–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Node.js, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á –≤ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –û–Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–∞–∑ –µ–≥–æ —Ä–∞–±–æ—Ç—ã, —á—Ç–æ–±—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∏–∑–±–µ–≥–∞—Ç—å –æ—à–∏–±–æ–∫.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ü–æ–Ω–∏–º–∞–π—Ç–µ —Ñ–∞–∑—ã Event Loop
- –ò–∑–±–µ–≥–∞–π—Ç–µ –±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `setTimeout` –∏ `setImmediate`

## üèÜ –ó–ê–î–ê–ß–ò

–í–æ—Ç –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å `Event Loop –≤ Node.js`:

---

### üìå –ó–∞–¥–∞—á–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á

‚ùì –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É Event Loop:
- –§—É–Ω–∫—Ü–∏—è `scheduleTask` –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
- –§—É–Ω–∫—Ü–∏—è `runScheduler` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á: immediate, timeout, interval
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏:
// scheduleTask(task, type, delay) - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É
// runScheduler() - –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã: 'immediate', 'timeout', 'interval'

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// scheduleTask(() => console.log('Task 1'), 'immediate');
// scheduleTask(() => console.log('Task 2'), 'timeout', 100);
// runScheduler();
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
class TaskScheduler {
    constructor() {
        this.tasks = [];
        this.isRunning = false;
        this.taskId = 0;
    }

    scheduleTask(task, type, delay = 0) {
        const taskId = ++this.taskId;
        const taskObj = {
            id: taskId,
            task,
            type,
            delay,
            scheduledAt: Date.now(),
            executed: false
        };

        this.tasks.push(taskObj);
        console.log(`üìÖ –ó–∞–¥–∞—á–∞ ${taskId} –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ (${type}, –∑–∞–¥–µ—Ä–∂–∫–∞: ${delay}ms)`);

        return taskId;
    }

    runScheduler() {
        if (this.isRunning) {
            console.log('‚ö†Ô∏è  –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–∂–µ –∑–∞–ø—É—â–µ–Ω');
            return;
        }

        this.isRunning = true;
        console.log('üöÄ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∑–∞–ø—É—â–µ–Ω\n');

        // –í—ã–ø–æ–ª–Ω—è–µ–º immediate –∑–∞–¥–∞—á–∏
        this.executeImmediateTasks();

        // –í—ã–ø–æ–ª–Ω—è–µ–º timeout –∑–∞–¥–∞—á–∏
        this.executeTimeoutTasks();

        // –í—ã–ø–æ–ª–Ω—è–µ–º interval –∑–∞–¥–∞—á–∏
        this.executeIntervalTasks();

        // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
        setTimeout(() => {
            this.isRunning = false;
            console.log('\n‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω');
            this.printSummary();
        }, 1000);
    }

    executeImmediateTasks() {
        console.log('üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ immediate –∑–∞–¥–∞—á...');
        
        const immediateTasks = this.tasks.filter(t => t.type === 'immediate' && !t.executed);
        
        immediateTasks.forEach(task => {
            try {
                const startTime = Date.now();
                task.task();
                const duration = Date.now() - startTime;
                
                task.executed = true;
                task.executedAt = Date.now();
                
                console.log(`   ‚úÖ –ó–∞–¥–∞—á–∞ ${task.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${duration}ms`);
            } catch (error) {
                console.error(`   ‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞—á–µ ${task.id}:`, error.message);
            }
        });
    }

    executeTimeoutTasks() {
        console.log('‚è∞ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ timeout –∑–∞–¥–∞—á...');
        
        const timeoutTasks = this.tasks.filter(t => t.type === 'timeout' && !t.executed);
        
        timeoutTasks.forEach(task => {
            setTimeout(() => {
                try {
                    const startTime = Date.now();
                    task.task();
                    const duration = Date.now() - startTime;
                    
                    task.executed = true;
                    task.executedAt = Date.now();
                    
                    console.log(`   ‚úÖ –ó–∞–¥–∞—á–∞ ${task.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${duration}ms (–∑–∞–¥–µ—Ä–∂–∫–∞: ${task.delay}ms)`);
                } catch (error) {
                    console.error(`   ‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞—á–µ ${task.id}:`, error.message);
                }
            }, task.delay);
        });
    }

    executeIntervalTasks() {
        console.log('üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ interval –∑–∞–¥–∞—á...');
        
        const intervalTasks = this.tasks.filter(t => t.type === 'interval' && !t.executed);
        
        intervalTasks.forEach(task => {
            const intervalId = setInterval(() => {
                try {
                    const startTime = Date.now();
                    task.task();
                    const duration = Date.now() - startTime;
                    
                    console.log(`   ‚úÖ –ó–∞–¥–∞—á–∞ ${task.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${duration}ms (interval)`);
                } catch (error) {
                    console.error(`   ‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞—á–µ ${task.id}:`, error.message);
                    clearInterval(intervalId);
                }
            }, task.delay);

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º interval —á–µ—Ä–µ–∑ 500ms
            setTimeout(() => {
                clearInterval(intervalId);
                task.executed = true;
                task.executedAt = Date.now();
            }, 500);
        });
    }

    printSummary() {
        console.log('\nüìä –°–≤–æ–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:');
        console.log(`   –í—Å–µ–≥–æ –∑–∞–¥–∞—á: ${this.tasks.length}`);
        console.log(`   –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${this.tasks.filter(t => t.executed).length}`);
        console.log(`   –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${this.tasks.filter(t => !t.executed).length}`);
        
        const executedTasks = this.tasks.filter(t => t.executed);
        if (executedTasks.length > 0) {
            console.log('\nüìã –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:');
            executedTasks
                .sort((a, b) => a.executedAt - b.executedAt)
                .forEach(task => {
                    const delay = task.executedAt - task.scheduledAt;
                    console.log(`   ${task.id}. ${task.type} (–∑–∞–¥–µ—Ä–∂–∫–∞: ${delay}ms)`);
                });
        }
    }

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã Event Loop
    demonstrateEventLoop() {
        console.log('üé≠ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Event Loop\n');
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
        console.log('1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥');
        
        // process.nextTick
        process.nextTick(() => {
            console.log('2. process.nextTick');
        });
        
        // Promise
        Promise.resolve().then(() => {
            console.log('3. Promise.then');
        });
        
        // setImmediate
        this.scheduleTask(() => {
            console.log('4. setImmediate');
        }, 'immediate');
        
        // setTimeout
        this.scheduleTask(() => {
            console.log('5. setTimeout(0)');
        }, 'timeout', 0);
        
        // setTimeout —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        this.scheduleTask(() => {
            console.log('6. setTimeout(100)');
        }, 'timeout', 100);
        
        console.log('7. –ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞');
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
        this.runScheduler();
    }
}

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
const scheduler = new TaskScheduler();

// –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏
scheduler.scheduleTask(() => console.log('–ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ 1'), 'immediate');
scheduler.scheduleTask(() => console.log('–ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ 2'), 'timeout', 50);
scheduler.scheduleTask(() => console.log('–ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ 3'), 'interval', 200);

// –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
scheduler.runScheduler();

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Event Loop
setTimeout(() => {
    console.log('\n' + '='.repeat(50));
    scheduler.demonstrateEventLoop();
}, 2000);

module.exports = TaskScheduler;
```

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Event Loop

‚ùì –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Event Loop:
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ Event Loop
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å EventLoopMonitor:
// start() - –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
// stop() - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
// getStats() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
// onLag(callback) - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// const monitor = new EventLoopMonitor();
// monitor.onLag((lag) => console.log('–í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞:', lag));
// monitor.start();
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
class EventLoopMonitor {
    constructor(options = {}) {
        this.isRunning = false;
        this.interval = options.interval || 1000; // –ò–Ω—Ç–µ—Ä–≤–∞–ª –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ –º—Å
        this.lagThreshold = options.lagThreshold || 50; // –ü–æ—Ä–æ–≥ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –º—Å
        this.maxSamples = options.maxSamples || 100; // –ú–∞–∫—Å–∏–º—É–º –æ–±—Ä–∞–∑—Ü–æ–≤
        
        this.samples = [];
        this.lagCallbacks = [];
        this.intervalId = null;
        this.startTime = null;
    }

    start() {
        if (this.isRunning) {
            console.log('‚ö†Ô∏è  –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–∂–µ –∑–∞–ø—É—â–µ–Ω');
            return;
        }

        this.isRunning = true;
        this.startTime = Date.now();
        console.log('üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Event Loop –∑–∞–ø—É—â–µ–Ω');

        this.intervalId = setInterval(() => {
            this.measureLag();
        }, this.interval);
    }

    stop() {
        if (!this.isRunning) {
            console.log('‚ö†Ô∏è  –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∑–∞–ø—É—â–µ–Ω');
            return;
        }

        this.isRunning = false;
        if (this.intervalId) {
            clearInterval(this.intervalId);
            this.intervalId = null;
        }

        console.log('‚èπÔ∏è  –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Event Loop –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
    }

    measureLag() {
        const start = process.hrtime.bigint();
        
        setImmediate(() => {
            const end = process.hrtime.bigint();
            const lag = Number(end - start) / 1000000; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
            
            this.recordSample(lag);
            this.checkLagThreshold(lag);
        });
    }

    recordSample(lag) {
        const sample = {
            timestamp: Date.now(),
            lag: lag,
            memoryUsage: process.memoryUsage(),
            uptime: process.uptime()
        };

        this.samples.push(sample);

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–∑—Ü–æ–≤
        if (this.samples.length > this.maxSamples) {
            this.samples.shift();
        }
    }

    checkLagThreshold(lag) {
        if (lag > this.lagThreshold) {
            console.warn(`‚ö†Ô∏è  –í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ Event Loop: ${lag.toFixed(2)}ms`);
            
            // –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            this.lagCallbacks.forEach(callback => {
                try {
                    callback(lag, this.getCurrentStats());
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∑–∞–¥–µ—Ä–∂–∫–∏:', error);
                }
            });
        }
    }

    onLag(callback) {
        if (typeof callback === 'function') {
            this.lagCallbacks.push(callback);
        }
    }

    getStats() {
        if (this.samples.length === 0) {
            return {
                samples: 0,
                averageLag: 0,
                maxLag: 0,
                minLag: 0,
                highLagCount: 0,
                uptime: process.uptime()
            };
        }

        const lags = this.samples.map(s => s.lag);
        const averageLag = lags.reduce((sum, lag) => sum + lag, 0) / lags.length;
        const maxLag = Math.max(...lags);
        const minLag = Math.min(...lags);
        const highLagCount = lags.filter(lag => lag > this.lagThreshold).length;

        return {
            samples: this.samples.length,
            averageLag: parseFloat(averageLag.toFixed(2)),
            maxLag: parseFloat(maxLag.toFixed(2)),
            minLag: parseFloat(minLag.toFixed(2)),
            highLagCount,
            uptime: process.uptime(),
            memoryUsage: process.memoryUsage()
        };
    }

    getCurrentStats() {
        const latest = this.samples[this.samples.length - 1];
        return latest ? {
            lag: latest.lag,
            memoryUsage: latest.memoryUsage,
            timestamp: latest.timestamp
        } : null;
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    createBlockingOperation(duration) {
        console.log(`üîí –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ ${duration}ms`);
        
        const start = Date.now();
        while (Date.now() - start < duration) {
            // –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
        }
        
        console.log(`‚úÖ –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞`);
    }

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    demonstrate() {
        console.log('üé≠ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Event Loop\n');

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
        this.onLag((lag, stats) => {
            console.log(`üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: ${lag.toFixed(2)}ms`);
            console.log(`   –ü–∞–º—è—Ç—å: ${(stats.memoryUsage.heapUsed / 1024 / 1024).toFixed(2)}MB`);
        });

        // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        this.start();

        // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
            console.log('\nüìä –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–≥–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏...');
            for (let i = 0; i < 1000; i++) {
                setImmediate(() => {
                    Math.random();
                });
            }
        }, 2000);

        setTimeout(() => {
            console.log('\nüîí –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏...');
            this.createBlockingOperation(200);
        }, 4000);

        setTimeout(() => {
            console.log('\nüìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:');
            const stats = this.getStats();
            console.log(`   –û–±—Ä–∞–∑—Ü–æ–≤: ${stats.samples}`);
            console.log(`   –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞: ${stats.averageLag}ms`);
            console.log(`   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: ${stats.maxLag}ms`);
            console.log(`   –í—ã—Å–æ–∫–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏: ${stats.highLagCount}`);
        }, 6000);

        setTimeout(() => {
            this.stop();
            console.log('\n‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }, 8000);
    }

    // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    exportData() {
        return {
            config: {
                interval: this.interval,
                lagThreshold: this.lagThreshold,
                maxSamples: this.maxSamples
            },
            samples: this.samples,
            stats: this.getStats()
        };
    }
}

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
const monitor = new EventLoopMonitor({
    interval: 500,
    lagThreshold: 30,
    maxSamples: 50
});

// –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
if (require.main === module) {
    monitor.demonstrate();
}

module.exports = EventLoopMonitor;
```

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á

‚ùì –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Event Loop:
- –û—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ (high, normal, low)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ Event Loop
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å AsyncTaskQueue:
// addTask(task, priority) - –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
// start() - –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ—Ä–µ–¥–∏
// stop() - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
// getQueueStatus() - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// const queue = new AsyncTaskQueue({ concurrency: 3 });
// queue.addTask(() => fetchData(), 'high');
// queue.start();
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
class AsyncTaskQueue {
    constructor(options = {}) {
        this.concurrency = options.concurrency || 3; // –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
        this.retryAttempts = options.retryAttempts || 3; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
        this.retryDelay = options.retryDelay || 1000; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
        
        this.queues = {
            high: [],
            normal: [],
            low: []
        };
        
        this.running = new Set();
        this.completed = [];
        this.failed = [];
        this.isProcessing = false;
        this.taskId = 0;
    }

    addTask(task, priority = 'normal', metadata = {}) {
        const taskId = ++this.taskId;
        const taskObj = {
            id: taskId,
            task,
            priority,
            metadata,
            attempts: 0,
            createdAt: Date.now(),
            status: 'pending'
        };

        this.queues[priority].push(taskObj);
        console.log(`üìù –ó–∞–¥–∞—á–∞ ${taskId} –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${priority})`);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
        if (!this.isProcessing) {
            this.start();
        }

        return taskId;
    }

    start() {
        if (this.isProcessing) {
            console.log('‚ö†Ô∏è  –û—á–µ—Ä–µ–¥—å —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è');
            return;
        }

        this.isProcessing = true;
        console.log('üöÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á –∑–∞–ø—É—â–µ–Ω–∞');

        this.processQueue();
    }

    stop() {
        this.isProcessing = false;
        console.log('‚èπÔ∏è  –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
    }

    processQueue() {
        if (!this.isProcessing) return;

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–¥–∞—á–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
        const priorities = ['high', 'normal', 'low'];
        
        for (const priority of priorities) {
            while (this.queues[priority].length > 0 && this.running.size < this.concurrency) {
                const task = this.queues[priority].shift();
                this.executeTask(task);
            }
        }

        // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
        if (this.hasPendingTasks() || this.running.size > 0) {
            setImmediate(() => this.processQueue());
        } else {
            this.isProcessing = false;
            console.log('‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã');
        }
    }

    async executeTask(taskObj) {
        taskObj.status = 'running';
        taskObj.startedAt = Date.now();
        this.running.add(taskObj.id);

        console.log(`üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ ${taskObj.id} (${taskObj.priority})`);

        try {
            // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–¥–∞—á—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
            const result = await this.runTask(taskObj.task);
            
            taskObj.status = 'completed';
            taskObj.completedAt = Date.now();
            taskObj.result = result;
            taskObj.duration = taskObj.completedAt - taskObj.startedAt;

            this.completed.push(taskObj);
            console.log(`‚úÖ –ó–∞–¥–∞—á–∞ ${taskObj.id} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${taskObj.duration}ms`);

        } catch (error) {
            taskObj.attempts++;
            taskObj.lastError = error.message;

            if (taskObj.attempts < this.retryAttempts) {
                console.log(`üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –¥–ª—è –∑–∞–¥–∞—á–∏ ${taskObj.id} (–ø–æ–ø—ã—Ç–∫–∞ ${taskObj.attempts}/${this.retryAttempts})`);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    this.queues[taskObj.priority].unshift(taskObj);
                    this.processQueue();
                }, this.retryDelay * taskObj.attempts);
            } else {
                taskObj.status = 'failed';
                taskObj.failedAt = Date.now();
                this.failed.push(taskObj);
                console.log(`‚ùå –ó–∞–¥–∞—á–∞ ${taskObj.id} –ø—Ä–æ–≤–∞–ª–µ–Ω–∞ –ø–æ—Å–ª–µ ${taskObj.attempts} –ø–æ–ø—ã—Ç–æ–∫: ${error.message}`);
            }
        } finally {
            this.running.delete(taskObj.id);
        }
    }

    runTask(task) {
        return new Promise((resolve, reject) => {
            try {
                const result = task();
                
                // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise
                if (result && typeof result.then === 'function') {
                    result.then(resolve).catch(reject);
                } else {
                    resolve(result);
                }
            } catch (error) {
                reject(error);
            }
        });
    }

    hasPendingTasks() {
        return Object.values(this.queues).some(queue => queue.length > 0);
    }

    getQueueStatus() {
        const pending = Object.values(this.queues).reduce((sum, queue) => sum + queue.length, 0);
        
        return {
            pending,
            running: this.running.size,
            completed: this.completed.length,
            failed: this.failed.length,
            concurrency: this.concurrency,
            isProcessing: this.isProcessing,
            queues: {
                high: this.queues.high.length,
                normal: this.queues.normal.length,
                low: this.queues.low.length
            }
        };
    }

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –æ—á–µ—Ä–µ–¥–∏
    demonstrate() {
        console.log('üé≠ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á\n');

        // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á
        const createTask = (name, duration, shouldFail = false) => {
            return () => {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (shouldFail) {
                            reject(new Error(`–ó–∞–¥–∞—á–∞ ${name} –ø—Ä–æ–≤–∞–ª–µ–Ω–∞`));
                        } else {
                            console.log(`   üìã –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: ${name}`);
                            resolve(`–†–µ–∑—É–ª—å—Ç–∞—Ç ${name}`);
                        }
                    }, duration);
                });
            };
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
        this.addTask(createTask('–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1', 100), 'high');
        this.addTask(createTask('–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1', 200), 'low');
        this.addTask(createTask('–û–±—ã—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1', 150), 'normal');
        this.addTask(createTask('–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2', 120), 'high');
        this.addTask(createTask('–û–±—ã—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2', 180), 'normal');
        this.addTask(createTask('–ü—Ä–æ–≤–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞', 100, true), 'normal');
        this.addTask(createTask('–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2', 250), 'low');

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–º —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏
        const statusInterval = setInterval(() => {
            const status = this.getQueueStatus();
            console.log(`\nüìä –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏:`);
            console.log(`   –û–∂–∏–¥–∞—é—Ç: ${status.pending}`);
            console.log(`   –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è: ${status.running}`);
            console.log(`   –ó–∞–≤–µ—Ä—à–µ–Ω—ã: ${status.completed}`);
            console.log(`   –ü—Ä–æ–≤–∞–ª–µ–Ω—ã: ${status.failed}`);
            console.log(`   –û—á–µ—Ä–µ–¥–∏: H:${status.queues.high} N:${status.queues.normal} L:${status.queues.low}`);

            if (status.pending === 0 && status.running === 0) {
                clearInterval(statusInterval);
                console.log('\n‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            }
        }, 500);
    }

    // –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
    clearCompleted() {
        this.completed = [];
        this.failed = [];
        console.log('üßπ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ—á–∏—â–µ–Ω—ã');
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    getStats() {
        const allTasks = [...this.completed, ...this.failed];
        const avgDuration = allTasks.length > 0 
            ? allTasks.reduce((sum, task) => sum + (task.duration || 0), 0) / allTasks.length 
            : 0;

        return {
            total: allTasks.length,
            completed: this.completed.length,
            failed: this.failed.length,
            successRate: allTasks.length > 0 ? (this.completed.length / allTasks.length * 100).toFixed(2) : 0,
            averageDuration: Math.round(avgDuration),
            byPriority: {
                high: allTasks.filter(t => t.priority === 'high').length,
                normal: allTasks.filter(t => t.priority === 'normal').length,
                low: allTasks.filter(t => t.priority === 'low').length
            }
        };
    }
}

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
if (require.main === module) {
    const queue = new AsyncTaskQueue({
        concurrency: 2,
        retryAttempts: 2,
        retryDelay: 500
    });

    queue.demonstrate();
}

module.exports = AsyncTaskQueue;
```

</details>

---

üéâ –≠—Ç–∏ –∑–∞–¥–∞—á–∏ –ø–æ–º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã Event Loop –≤ Node.js –∏ –Ω–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã.

---
