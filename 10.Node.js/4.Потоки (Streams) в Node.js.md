# üìå –ü–æ—Ç–æ–∫–∏ (Streams) –≤ Node.js

**Stream (–ø–æ—Ç–æ–∫)** –≤ Node.js ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —á–∞—Å—Ç—è–º, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø–∞–º—è—Ç—å. –ü–æ—Ç–æ–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–µ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏ –∏–ª–∏ —á—Ç–µ–Ω–∏–∏/–∑–∞–ø–∏—Å–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞.

Node.js —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `stream`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö "–ø–æ —á–∞—Å—Ç—è–º", —Å–æ—Ö—Ä–∞–Ω—è—è —Ä–µ—Å—É—Ä—Å—ã –∏ —É—Å–∫–æ—Ä—è—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

## üîπ –¢–∏–ø—ã –ø–æ—Ç–æ–∫–æ–≤ –≤ Node.js

### üìå 1. Readable (—á–∏—Ç–∞–µ–º—ã–µ –ø–æ—Ç–æ–∫–∏)
**–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.** –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ HTTP-–∑–∞–ø—Ä–æ—Å–∞.

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const fs = require('fs');

const readableStream = fs.createReadStream('file.txt');

readableStream.on('data', chunk => {
    console.log(`–ü–æ–ª—É—á–µ–Ω –∫—É—Å–æ–∫ –¥–∞–Ω–Ω—ã—Ö: ${chunk}`);
});

readableStream.on('end', () => {
    console.log('–ß—Ç–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
});

readableStream.on('error', err => {
    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è:', err);
});
```

### üìå 2. Writable (–∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–µ –ø–æ—Ç–æ–∫–∏)
**–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö.** –ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ HTTP-–æ—Ç–≤–µ—Ç.

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const fs = require('fs');

const writableStream = fs.createWriteStream('output.txt');

writableStream.write('Hello, Stream!');
writableStream.write('\n–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞');
writableStream.end(); // –ó–∞–≤–µ—Ä—à–∞–µ–º –∑–∞–ø–∏—Å—å

writableStream.on('finish', () => {
    console.log('–ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
});

writableStream.on('error', err => {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', err);
});
```

### üìå 3. Duplex (–¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏)
**–ú–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞–µ–º—ã–º–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–º–∏.** –ü—Ä–∏–º–µ—Ä ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Ç–µ–≤—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏.

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const { Duplex } = require('stream');

const duplexStream = new Duplex({
    write(chunk, encoding, callback) {
        console.log(`–ó–∞–ø–∏—Å—å: ${chunk}`);
        callback();
    },
    read(size) {
        this.push('–î–∞–Ω–Ω—ã–µ –¥–ª—è —á—Ç–µ–Ω–∏—è');
        this.push(null); // –ö–æ–Ω–µ—Ü –ø–æ—Ç–æ–∫–∞
    },
});

duplexStream.on('data', chunk => console.log(`–ß—Ç–µ–Ω–∏–µ: ${chunk}`));
duplexStream.write('–ü—Ä–∏–≤–µ—Ç, Duplex!');
```

### üìå 4. Transform (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–µ –ø–æ—Ç–æ–∫–∏)
**–≠—Ç–æ —á–∞—Å—Ç–Ω—ã–π —Å–ª—É—á–∞–π Duplex-–ø–æ—Ç–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–¥–∞—á–∏.** –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–∂–∞—Ç–∏–µ –∏–ª–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ.

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const { Transform } = require('stream');

const transformStream = new Transform({
    transform(chunk, encoding, callback) {
        this.push(chunk.toString().toUpperCase());
        callback();
    },
});

process.stdin.pipe(transformStream).pipe(process.stdout);
```

---

## üîπ –ö–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Stream –≤ Node.js?

### üìå 1. –†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
**–ï—Å–ª–∏ —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ —Ü–µ–ª–∏–∫–æ–º –≤ –ø–∞–º—è—Ç—å.**

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const fs = require('fs');

const readable = fs.createReadStream('bigfile.txt');
const writable = fs.createWriteStream('output.txt');

readable.pipe(writable);

readable.on('end', () => {
    console.log('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
});
```

### üìå 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
**–ü–æ—Ç–æ–∫–∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ –≤–∏–¥–µ–æ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏, –∞—É–¥–∏–æ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ–Ω—Å–æ—Ä–æ–≤.**

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const { Transform } = require('stream');

const dataProcessor = new Transform({
    transform(chunk, encoding, callback) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        const processed = processData(chunk);
        this.push(processed);
        callback();
    }
});

sensorDataStream.pipe(dataProcessor).pipe(outputStream);
```

### üìå 3. –†–∞–±–æ—Ç–∞ —Å HTTP-–∑–∞–ø—Ä–æ—Å–∞–º–∏/–æ—Ç–≤–µ—Ç–∞–º–∏
**HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –≤ Node.js —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ —á–∏—Ç–∞–µ–º—ã–µ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–µ –ø–æ—Ç–æ–∫–∏.**

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const http = require('http');

http.createServer((req, res) => {
    // –≠—Ö–æ-—Å–µ—Ä–≤–µ—Ä —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–æ—Ç–æ–∫–æ–≤
    req.pipe(res);
}).listen(3000);

// –ò–ª–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
http.createServer((req, res) => {
    let data = '';
    
    req.on('data', chunk => {
        data += chunk;
    });
    
    req.on('end', () => {
        res.writeHead(200, { 'Content-Type': 'text/plain' });
        res.end(`–ü–æ–ª—É—á–µ–Ω–æ: ${data}`);
    });
}).listen(3000);
```

### üìå 4. –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö
**–ü–æ—Ç–æ–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ zlib, –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–∂–∏–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ "–Ω–∞ –ª–µ—Ç—É".**

#### ‚úç –ü—Ä–∏–º–µ—Ä:
```javascript
const zlib = require('zlib');
const fs = require('fs');

const gzip = zlib.createGzip();
const readable = fs.createReadStream('file.txt');
const writable = fs.createWriteStream('file.txt.gz');

readable.pipe(gzip).pipe(writable);

writable.on('finish', () => {
    console.log('–§–∞–π–ª —Å–∂–∞—Ç —É—Å–ø–µ—à–Ω–æ');
});
```

### üìå 5. –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
**–ü–æ—Ç–æ–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ "–ø–æ —á–∞—Å—Ç—è–º", —Å–Ω–∏–∂–∞—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.**

---

## üîπ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Stream

### ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
–ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ–±–æ–ª—å—à–∏–º–∏ —á–∞—Å—Ç—è–º–∏, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å.

### ‚úÖ –ë—ã—Å—Ç—Ä–æ—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
–ü–æ—Ç–æ–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã, –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–Ω–æ–≥–æ –æ–±—ä–µ–º–∞.

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ (pipe)
–ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `.pipe()`, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω–≤–µ–π–µ—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

#### ‚úç –ü—Ä–∏–º–µ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞:
```javascript
const fs = require('fs');
const zlib = require('zlib');

fs.createReadStream('input.txt')
  .pipe(zlib.createGzip())
  .pipe(fs.createWriteStream('output.txt.gz'));
```

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

---

## üîπ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

### ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏
–û—à–∏–±–∫–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ—Ç–æ–∫–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

### ‚ùå –ö—Ä–∏–≤–∞—è –æ–±—É—á–µ–Ω–∏—è
–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏, –∏—Ö —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –º–µ—Ç–æ–¥–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏.

### ‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–º–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
–ü–æ—Ç–æ–∫–∏ —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫, –∏–Ω–∞—á–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç ¬´—Å–ª–æ–º–∞—Ç—å—Å—è¬ª –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

---

## üîπ –°–æ–±—ã—Ç–∏—è –ø–æ—Ç–æ–∫–æ–≤

### üìå Readable –ø–æ—Ç–æ–∫–∏
- `data` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `end` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è
- `error` ‚Äî –æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è
- `close` ‚Äî –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ç–æ–∫–∞

### üìå Writable –ø–æ—Ç–æ–∫–∏
- `drain` ‚Äî –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø–∏—Å–∏
- `finish` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `error` ‚Äî –æ—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏
- `close` ‚Äî –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ç–æ–∫–∞

#### ‚úç –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π:
```javascript
const fs = require('fs');

const readable = fs.createReadStream('input.txt');
const writable = fs.createWriteStream('output.txt');

readable.on('data', chunk => {
    console.log(`–ü—Ä–æ—á–∏—Ç–∞–Ω–æ: ${chunk.length} –±–∞–π—Ç`);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å
    if (!writable.write(chunk)) {
        // –ï—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–æ–ª–æ–Ω, –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á—Ç–µ–Ω–∏–µ
        readable.pause();
    }
});

writable.on('drain', () => {
    // –ë—É—Ñ–µ—Ä –æ—Å–≤–æ–±–æ–¥–∏–ª—Å—è, –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —á—Ç–µ–Ω–∏–µ
    readable.resume();
});

readable.on('end', () => {
    writable.end();
});

readable.on('error', err => {
    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è:', err);
});

writable.on('error', err => {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', err);
});
```

---

## üéØ –ò—Ç–æ–≥

**–ü–æ—Ç–æ–∫–∏** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ Node.js –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –û–Ω–∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –∑–∞–¥–∞—á, –≥–¥–µ –≤–∞–∂–Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç—å –ø–∞–º—è—Ç—å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Å—Ç—Ä–æ–∏—Ç—å –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –≠–∫–æ–Ω–æ–º—å—Ç–µ –ø–∞–º—è—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–π–ø–ª–∞–π–Ω—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üèÜ –ó–ê–î–ê–ß–ò

–í–æ—Ç –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å `–ø–æ—Ç–æ–∫–∏ (Streams) –≤ Node.js`:

---

### üìå –ó–∞–¥–∞—á–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤—â–∏–∫–∞

‚ùì –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é –ø–æ—Ç–æ–∫–æ–≤. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞:
- –ß–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –ø–æ —á–∞—Å—Ç—è–º
- –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é copyFileWithProgress, –∫–æ—Ç–æ—Ä–∞—è:
// - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—É—Ç–∏ –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∏ —Ü–µ–ª–µ–≤–æ–º—É —Ñ–∞–π–ª–∞–º
// - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ç–æ–∫–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
// - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
// - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// copyFileWithProgress('input.txt', 'output.txt');
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
const fs = require('fs');
const path = require('path');

function copyFileWithProgress(sourcePath, destPath) {
    return new Promise((resolve, reject) => {
        // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        const stats = fs.statSync(sourcePath);
        const fileSize = stats.size;
        let copiedBytes = 0;

        console.log(`–ù–∞—á–∏–Ω–∞–µ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Ä–∞–∑–º–µ—Ä–æ–º ${fileSize} –±–∞–π—Ç`);

        const readable = fs.createReadStream(sourcePath);
        const writable = fs.createWriteStream(destPath);

        readable.on('data', chunk => {
            copiedBytes += chunk.length;
            const progress = ((copiedBytes / fileSize) * 100).toFixed(2);
            process.stdout.write(`\r–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}% (${copiedBytes}/${fileSize} –±–∞–π—Ç)`);
        });

        readable.on('end', () => {
            console.log('\n‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
            resolve();
        });

        readable.on('error', err => {
            console.error('\n‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è:', err.message);
            reject(err);
        });

        writable.on('error', err => {
            console.error('\n‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', err.message);
            reject(err);
        });

        // –°–æ–µ–¥–∏–Ω—è–µ–º –ø–æ—Ç–æ–∫–∏
        readable.pipe(writable);
    });
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
copyFileWithProgress('input.txt', 'output.txt')
    .then(() => console.log('–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞'))
    .catch(err => console.error('–û—à–∏–±–∫–∞:', err.message));
```

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞

‚ùì –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–π –ø–æ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π:
- –ß–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—Å–µ —Å–ª–æ–≤–∞ –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
- –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å TextProcessor, –∫–æ—Ç–æ—Ä—ã–π:
// - –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Transform
// - –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –∫ —Ç–µ–∫—Å—Ç—É
// - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
// - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// const processor = new TextProcessor();
// fs.createReadStream('input.txt')
//   .pipe(processor)
//   .pipe(fs.createWriteStream('output.txt'));
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
const { Transform } = require('stream');
const fs = require('fs');

class TextProcessor extends Transform {
    constructor(options = {}) {
        super(options);
        this.lineNumber = 1;
    }

    _transform(chunk, encoding, callback) {
        // –†–∞–∑–±–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–æ–∫–∏
        const data = chunk.toString();
        const lines = data.split('\n');
        
        let processedData = '';
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i];
            
            if (line.trim() !== '') {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
                processedData += `${this.lineNumber}: ${line.toUpperCase()}\n`;
                this.lineNumber++;
            } else {
                processedData += '\n';
            }
        }
        
        this.push(processedData);
        callback();
    }

    _flush(callback) {
        // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ—Ç–æ–∫–∞
        console.log(`–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: ${this.lineNumber - 1}`);
        callback();
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const processor = new TextProcessor();

fs.createReadStream('input.txt')
  .pipe(processor)
  .pipe(fs.createWriteStream('output.txt'));

processor.on('finish', () => {
    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
});

processor.on('error', err => {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', err.message);
});
```

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ HTTP-—Å–µ—Ä–≤–µ—Ä–∞ —Å –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

‚ùì –°–æ–∑–¥–∞–π—Ç–µ HTTP-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ POST-–∑–∞–ø—Ä–æ—Å
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–æ—Ç–æ–∫–æ–≤–æ (—Å–∂–∏–º–∞–µ—Ç)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∂–∞—Ç—ã–π —Ñ–∞–π–ª
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ HTTP-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
// - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ multipart/form-data
// - –°–∂–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã —Å –ø–æ–º–æ—â—å—é gzip
// - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∂–∞—Ç—ã–π —Ñ–∞–π–ª
// - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏ —Å–∂–∞—Ç–æ–≥–æ —Ñ–∞–π–ª–∞

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// POST /compress
// Content-Type: multipart/form-data
// file: [–≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª]
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
const http = require('http');
const zlib = require('zlib');
const fs = require('fs');
const path = require('path');

const server = http.createServer((req, res) => {
    if (req.method === 'POST' && req.url === '/compress') {
        let originalSize = 0;
        let compressedSize = 0;
        
        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —Å–∂–∞—Ç–∏—è
        const tempFile = `temp_${Date.now()}.gz`;
        const gzip = zlib.createGzip();
        const writable = fs.createWriteStream(tempFile);
        
        console.log('–ù–∞—á–∏–Ω–∞–µ–º —Å–∂–∞—Ç–∏–µ —Ñ–∞–π–ª–∞...');
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        req.on('data', chunk => {
            originalSize += chunk.length;
            console.log(`–ü–æ–ª—É—á–µ–Ω–æ: ${originalSize} –±–∞–π—Ç`);
        });
        
        // –°–∂–∏–º–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        req.pipe(gzip).pipe(writable);
        
        writable.on('finish', () => {
            // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å–∂–∞—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
            const stats = fs.statSync(tempFile);
            compressedSize = stats.size;
            
            const compressionRatio = ((1 - compressedSize / originalSize) * 100).toFixed(2);
            
            console.log(`–°–∂–∞—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:`);
            console.log(`–ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${originalSize} –±–∞–π—Ç`);
            console.log(`–°–∂–∞—Ç—ã–π —Ä–∞–∑–º–µ—Ä: ${compressedSize} –±–∞–π—Ç`);
            console.log(`–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è: ${compressionRatio}%`);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∂–∞—Ç—ã–π —Ñ–∞–π–ª
            res.writeHead(200, {
                'Content-Type': 'application/gzip',
                'Content-Disposition': 'attachment; filename="compressed.gz"',
                'Content-Length': compressedSize
            });
            
            const readable = fs.createReadStream(tempFile);
            readable.pipe(res);
            
            // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
            readable.on('end', () => {
                fs.unlinkSync(tempFile);
                console.log('–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω');
            });
        });
        
        writable.on('error', err => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', err);
            res.writeHead(500, { 'Content-Type': 'text/plain' });
            res.end('–û—à–∏–±–∫–∞ —Å–∂–∞—Ç–∏—è —Ñ–∞–π–ª–∞');
        });
        
    } else if (req.method === 'GET' && req.url === '/') {
        // –ü—Ä–æ—Å—Ç–∞—è HTML-—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
        res.end(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>–°–∂–∞—Ç–∏–µ —Ñ–∞–π–ª–æ–≤</title>
                <meta charset="utf-8">
            </head>
            <body>
                <h1>–°–∂–∞—Ç–∏–µ —Ñ–∞–π–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é –ø–æ—Ç–æ–∫–æ–≤</h1>
                <form action="/compress" method="post" enctype="multipart/form-data">
                    <input type="file" name="file" required>
                    <button type="submit">–°–∂–∞—Ç—å —Ñ–∞–π–ª</button>
                </form>
            </body>
            </html>
        `);
    } else {
        res.writeHead(404, { 'Content-Type': 'text/plain' });
        res.end('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    }
});

const PORT = 3000;
server.listen(PORT, () => {
    console.log(`üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:${PORT}`);
    console.log('–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è —Å–∂–∞—Ç–∏—è');
});

server.on('error', err => {
    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', err);
});
```

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 4: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

‚ùì –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤, –∫–æ—Ç–æ—Ä–∞—è:
- –ß–∏—Ç–∞–µ—Ç –ª–æ–≥-—Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
- –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ JSON
- –°–∂–∏–º–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∞—Ä—Ö–∏–≤

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤:
// 1. LogReader - —á–∏—Ç–∞–µ—Ç –ª–æ–≥-—Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
// 2. ErrorFilter - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–∞–º–∏
// 3. JSONFormatter - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç
// 4. GzipCompressor - —Å–∂–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
// 5. FileWriter - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// const pipeline = new LogProcessor();
// pipeline.processLogs('app.log', 'errors.json.gz');
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
const { Transform, Readable } = require('stream');
const fs = require('fs');
const zlib = require('zlib');
const path = require('path');

// –ö–ª–∞—Å—Å –¥–ª—è —á—Ç–µ–Ω–∏—è –ª–æ–≥-—Ñ–∞–π–ª–∞ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
class LogReader extends Readable {
    constructor(filePath, options = {}) {
        super(options);
        this.filePath = filePath;
        this.buffer = '';
    }

    _read() {
        if (!this.fileStream) {
            this.fileStream = fs.createReadStream(this.filePath);
            
            this.fileStream.on('data', chunk => {
                this.buffer += chunk.toString();
                const lines = this.buffer.split('\n');
                
                // –û—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–ø–æ–ª–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ –±—É—Ñ–µ—Ä–µ
                this.buffer = lines.pop() || '';
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
                lines.forEach(line => {
                    if (line.trim()) {
                        this.push(line);
                    }
                });
            });
            
            this.fileStream.on('end', () => {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                if (this.buffer.trim()) {
                    this.push(this.buffer);
                }
                this.push(null); // –ö–æ–Ω–µ—Ü –ø–æ—Ç–æ–∫–∞
            });
            
            this.fileStream.on('error', err => {
                this.destroy(err);
            });
        }
    }
}

// –§–∏–ª—å—Ç—Ä –¥–ª—è –æ—à–∏–±–æ–∫
class ErrorFilter extends Transform {
    constructor(options = {}) {
        super(options);
        this.errorCount = 0;
    }

    _transform(chunk, encoding, callback) {
        const line = chunk.toString();
        
        // –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–∞–º–∏ (—Å–æ–¥–µ—Ä–∂–∞—Ç ERROR, FATAL, Exception)
        if (line.match(/(ERROR|FATAL|Exception|Error)/i)) {
            this.errorCount++;
            this.push(line);
        }
        
        callback();
    }

    _flush(callback) {
        console.log(`–ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫: ${this.errorCount}`);
        callback();
    }
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤—â–∏–∫ –≤ JSON
class JSONFormatter extends Transform {
    constructor(options = {}) {
        super(options);
        this.lineNumber = 1;
    }

    _transform(chunk, encoding, callback) {
        const line = chunk.toString();
        
        const logEntry = {
            lineNumber: this.lineNumber++,
            timestamp: this.extractTimestamp(line),
            level: this.extractLevel(line),
            message: line.trim(),
            processedAt: new Date().toISOString()
        };
        
        this.push(JSON.stringify(logEntry) + '\n');
        callback();
    }

    extractTimestamp(line) {
        const match = line.match(/(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})/);
        return match ? match[1] : new Date().toISOString();
    }

    extractLevel(line) {
        if (line.includes('FATAL')) return 'FATAL';
        if (line.includes('ERROR')) return 'ERROR';
        if (line.includes('Exception')) return 'EXCEPTION';
        return 'UNKNOWN';
    }
}

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤
class LogProcessor {
    constructor() {
        this.processedCount = 0;
    }

    async processLogs(inputFile, outputFile) {
        return new Promise((resolve, reject) => {
            console.log(`üîÑ –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –ª–æ–≥-—Ñ–∞–π–ª–∞: ${inputFile}`);
            
            const reader = new LogReader(inputFile);
            const errorFilter = new ErrorFilter();
            const jsonFormatter = new JSONFormatter();
            const gzipCompressor = zlib.createGzip();
            const writer = fs.createWriteStream(outputFile);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
            jsonFormatter.on('data', () => {
                this.processedCount++;
                if (this.processedCount % 10 === 0) {
                    process.stdout.write(`\r–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${this.processedCount}`);
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏
            reader
                .pipe(errorFilter)
                .pipe(jsonFormatter)
                .pipe(gzipCompressor)
                .pipe(writer);
            
            writer.on('finish', () => {
                console.log(`\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`);
                console.log(`üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: ${outputFile}`);
                console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${this.processedCount}`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
                const inputStats = fs.statSync(inputFile);
                const outputStats = fs.statSync(outputFile);
                const compressionRatio = ((1 - outputStats.size / inputStats.size) * 100).toFixed(2);
                
                console.log(`üìà –ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${inputStats.size} –±–∞–π—Ç`);
                console.log(`üìà –°–∂–∞—Ç—ã–π —Ä–∞–∑–º–µ—Ä: ${outputStats.size} –±–∞–π—Ç`);
                console.log(`üìà –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è: ${compressionRatio}%`);
                
                resolve();
            });
            
            writer.on('error', reject);
            reader.on('error', reject);
        });
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
async function main() {
    const processor = new LogProcessor();
    
    try {
        await processor.processLogs('app.log', 'errors.json.gz');
        console.log('üéâ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', error.message);
    }
}

// –ó–∞–ø—É—Å–∫, –µ—Å–ª–∏ —Ñ–∞–π–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
    main();
}

module.exports = { LogProcessor, LogReader, ErrorFilter, JSONFormatter };
```

</details>

---

### üìå –ó–∞–¥–∞—á–∞ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ—Ç–æ–∫–æ–≤

‚ùì –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä–∞—è:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤
- –ò–∑–º–µ—Ä—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤

```javascript
// –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å StreamMonitor, –∫–æ—Ç–æ—Ä—ã–π:
// - –û–±–µ—Ä—Ç—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Ç–æ–∫–∏
// - –ò–∑–º–µ—Ä—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
// - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
// - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤
// - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç—ã –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
// const monitor = new StreamMonitor();
// const monitoredStream = monitor.wrap(originalStream);
```

<details>
<summary>‚úç –†–µ—à–µ–Ω–∏–µ</summary>

```javascript
const { Transform, PassThrough } = require('stream');
const fs = require('fs');

class StreamMonitor extends Transform {
    constructor(options = {}) {
        super(options);
        this.stats = {
            bytesProcessed: 0,
            startTime: Date.now(),
            chunksProcessed: 0,
            errors: 0,
            lastChunkTime: Date.now(),
            averageSpeed: 0,
            peakSpeed: 0,
            memoryUsage: process.memoryUsage()
        };
        
        this.reportInterval = options.reportInterval || 5000; // 5 —Å–µ–∫—É–Ω–¥
        this.maxBufferSize = options.maxBufferSize || 1024 * 1024; // 1MB
        this.bufferSize = 0;
        
        this.startMonitoring();
    }

    _transform(chunk, encoding, callback) {
        const now = Date.now();
        const chunkSize = chunk.length;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        this.stats.bytesProcessed += chunkSize;
        this.stats.chunksProcessed++;
        this.bufferSize += chunkSize;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
        if (this.bufferSize > this.maxBufferSize) {
            console.warn('‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –±—É—Ñ–µ—Ä –±–ª–∏–∑–æ–∫ –∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é');
            // –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á—Ç–µ–Ω–∏–µ, –µ—Å–ª–∏ —ç—Ç–æ readable –ø–æ—Ç–æ–∫
            if (this.readable && this.pause) {
                this.pause();
                setTimeout(() => {
                    this.resume();
                    this.bufferSize = 0;
                }, 100);
            }
        }
        
        // –í—ã—á–∏—Å–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
        const timeDiff = now - this.stats.lastChunkTime;
        if (timeDiff > 0) {
            const currentSpeed = (chunkSize / timeDiff) * 1000; // –±–∞–π—Ç/—Å–µ–∫
            this.stats.averageSpeed = (this.stats.averageSpeed + currentSpeed) / 2;
            this.stats.peakSpeed = Math.max(this.stats.peakSpeed, currentSpeed);
        }
        
        this.stats.lastChunkTime = now;
        this.stats.memoryUsage = process.memoryUsage();
        
        // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ
        this.push(chunk);
        callback();
    }

    _flush(callback) {
        this.generateFinalReport();
        callback();
    }

    startMonitoring() {
        this.monitorInterval = setInterval(() => {
            this.generateProgressReport();
        }, this.reportInterval);
    }

    generateProgressReport() {
        const elapsed = Date.now() - this.stats.startTime;
        const speed = this.stats.bytesProcessed / (elapsed / 1000);
        const memoryMB = this.stats.memoryUsage.heapUsed / 1024 / 1024;
        
        console.log(`
üìä –û—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Ç–æ–∫–æ–≤:
   ‚è±Ô∏è  –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${(elapsed / 1000).toFixed(2)}—Å
   üì¶ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –±–∞–π—Ç: ${this.formatBytes(this.stats.bytesProcessed)}
   üîÑ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞–Ω–∫–æ–≤: ${this.stats.chunksProcessed}
   üöÄ –¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${this.formatBytes(speed)}/—Å
   üìà –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${this.formatBytes(this.stats.averageSpeed)}/—Å
   üèÜ –ü–∏–∫–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${this.formatBytes(this.stats.peakSpeed)}/—Å
   üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: ${memoryMB.toFixed(2)}MB
   üìã –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞: ${this.formatBytes(this.bufferSize)}
        `);
    }

    generateFinalReport() {
        const elapsed = Date.now() - this.stats.startTime;
        const avgSpeed = this.stats.bytesProcessed / (elapsed / 1000);
        const memoryMB = this.stats.memoryUsage.heapUsed / 1024 / 1024;
        
        console.log(`
üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢:
   ‚è±Ô∏è  –û–±—â–µ–µ –≤—Ä–µ–º—è: ${(elapsed / 1000).toFixed(2)}—Å
   üì¶ –í—Å–µ–≥–æ –±–∞–π—Ç: ${this.formatBytes(this.stats.bytesProcessed)}
   üîÑ –í—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤: ${this.stats.chunksProcessed}
   üöÄ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${this.formatBytes(avgSpeed)}/—Å
   üèÜ –ü–∏–∫–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${this.formatBytes(this.stats.peakSpeed)}/—Å
   üíæ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å: ${memoryMB.toFixed(2)}MB
   ‚ùå –û—à–∏–±–æ–∫: ${this.stats.errors}
        `);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç –≤ —Ñ–∞–π–ª
        this.saveReportToFile();
    }

    saveReportToFile() {
        const report = {
            timestamp: new Date().toISOString(),
            duration: Date.now() - this.stats.startTime,
            bytesProcessed: this.stats.bytesProcessed,
            chunksProcessed: this.stats.chunksProcessed,
            averageSpeed: this.stats.averageSpeed,
            peakSpeed: this.stats.peakSpeed,
            memoryUsage: this.stats.memoryUsage,
            errors: this.stats.errors
        };
        
        const reportFile = `stream-report-${Date.now()}.json`;
        fs.writeFileSync(reportFile, JSON.stringify(report, null, 2));
        console.log(`üìÑ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª: ${reportFile}`);
    }

    formatBytes(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –æ–±–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
    static wrap(stream, options = {}) {
        const monitor = new StreamMonitor(options);
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –æ—à–∏–±–æ–∫
        stream.on('error', (err) => {
            monitor.stats.errors++;
            monitor.emit('error', err);
        });
        
        // –°–æ–∑–¥–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
        return stream.pipe(monitor);
    }

    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    stop() {
        if (this.monitorInterval) {
            clearInterval(this.monitorInterval);
        }
    }
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
function demonstrateMonitoring() {
    console.log('üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ—Ç–æ–∫–æ–≤');
    
    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
    const testData = 'A'.repeat(1000000); // 1MB –¥–∞–Ω–Ω—ã—Ö
    fs.writeFileSync('test-data.txt', testData);
    
    // –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫–∏ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
    const reader = fs.createReadStream('test-data.txt');
    const monitor = new StreamMonitor({ 
        reportInterval: 2000,
        maxBufferSize: 500 * 1024 // 500KB
    });
    const writer = fs.createWriteStream('output-monitored.txt');
    
    // –û–±–µ—Ä—Ç—ã–≤–∞–µ–º –ø–æ—Ç–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
    const monitoredReader = StreamMonitor.wrap(reader, {
        reportInterval: 1000
    });
    
    // –°–æ–∑–¥–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω
    monitoredReader.pipe(monitor).pipe(writer);
    
    writer.on('finish', () => {
        console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        monitor.stop();
        
        // –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
        fs.unlinkSync('test-data.txt');
        fs.unlinkSync('output-monitored.txt');
    });
}

// –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
if (require.main === module) {
    demonstrateMonitoring();
}

module.exports = { StreamMonitor };
```

</details>

---

üéâ –≠—Ç–∏ –∑–∞–¥–∞—á–∏ –ø–æ–º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏ –≤ Node.js –∏ –Ω–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

---
