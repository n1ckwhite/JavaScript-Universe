# Область видимости и лексическое окружение в JavaScript

Область видимости и лексическое окружение — ключевые концепции в JavaScript, которые помогают управлять доступностью переменных, функций и объектов. Эти понятия играют важную роль в написании эффективного, безопасного и модульного кода.

---

## 1. Лексическое окружение

**Лексическое окружение** — это структура, которая управляет доступом к переменным и функциям в определенном контексте выполнения. Когда создается функция, создается и ее лексическое окружение, которое включает:
- **Переменные и функции**, объявленные внутри данной функции.
- **Ссылку на родительское окружение**, которая позволяет обращаться к переменным из внешнего контекста.

### Пример:
```javascript
function outerFunction() {
    let outerVar = 'Я из внешней функции';
    
    function innerFunction() {
        console.log(outerVar); // Доступ к переменной из внешнего окружения
    }
    
    return innerFunction;
}

const inner = outerFunction();
inner(); // Вывод: "Я из внешней функции"
```

### Как это работает:
1. `outerFunction` создает своё лексическое окружение с переменной `outerVar`.
2. `innerFunction` "запоминает" лексическое окружение `outerFunction`, сохраняя доступ к `outerVar`.
3. Когда `inner()` вызывается, движок JavaScript ищет `outerVar` сначала в своем лексическом окружении, затем в родительском.

---

## 2. Область видимости

**Область видимости (scope)** — это контекст, в котором доступны переменные. В JavaScript существует три основные области видимости:
1. **Глобальная область видимости**.
2. **Функциональная (локальная) область видимости**.
3. **Блочная область видимости** (введена в ES6).

### 2.1 Глобальная область видимости
Переменные, объявленные вне функций или блоков, находятся в глобальной области видимости и доступны из любой части программы.

#### Пример:
```javascript
var globalVar = 'Я глобальная переменная';

function showGlobalVar() {
    console.log(globalVar); // Доступно
}

showGlobalVar(); // "Я глобальная переменная"
console.log(globalVar); // "Я глобальная переменная"
```

### 2.2 Локальная (функциональная) область видимости
Переменные, объявленные внутри функции, доступны только в пределах этой функции.

#### Пример:
```javascript
function myFunction() {
    var localVar = 'Я локальная переменная';
    console.log(localVar); // Доступно
}

myFunction();
console.log(localVar); // Ошибка: localVar не определена
```

### 2.3 Блочная область видимости
С ключевыми словами `let` и `const` можно создавать переменные, доступные только внутри конкретного блока кода `{}`.

#### Пример:
```javascript
if (true) {
    let blockVar = 'Я переменная блока';
    console.log(blockVar); // "Я переменная блока"
}

console.log(blockVar); // Ошибка: blockVar не определена
```

---

## 3. Замыкания

**Замыкание (closure)** — это функция, которая "запоминает" своё лексическое окружение, даже если внешняя функция уже завершила выполнение.

### Пример:
```javascript
function counter() {
    let count = 0;

    return function () {
        count++;
        console.log(count);
    };
}

const increment = counter();
increment(); // 1
increment(); // 2
```

### Как это работает:
- Функция `counter` возвращает другую функцию, которая сохраняет доступ к переменной `count` из своего лексического окружения.
- При каждом вызове `increment` переменная `count` увеличивается.

---

## 4. Различия между `var`, `let` и `const`

### 4.1 `var`
- **Функциональная область видимости**: Переменные, объявленные через `var`, доступны в пределах функции.
- **Подъем (hoisting)**: Переменные поднимаются вверх своей области видимости, но их значение до объявления равно `undefined`.

#### Пример:
```javascript
function example() {
    console.log(a); // undefined
    var a = 10;
    console.log(a); // 10
}

example();
```

---

### 4.2 `let`
- **Блочная область видимости**: Доступ к переменной есть только внутри блока `{}`.
- **Подъем**: Переменные поднимаются, но нельзя использовать до их фактического объявления (временная мертвая зона).

#### Пример:
```javascript
if (true) {
    let b = 20;
    console.log(b); // 20
}

// console.log(b); // Ошибка: b не определена
```

---

### 4.3 `const`
- **Блочная область видимости**: Как и `let`, `const` ограничивается блоком `{}`.
- **Неизменяемость**: Переменные `const` нельзя переназначить, но можно изменять свойства объектов или элементов массивов.

#### Пример:
```javascript
const numbers = [1, 2, 3];
numbers.push(4);
console.log(numbers); // [1, 2, 3, 4]

// numbers = [5, 6]; // Ошибка: нельзя переназначить
```

---

## Итог

1. **Лексическое окружение**:
    - Структура, которая управляет доступом к переменным и функциям.
    - Включает объект окружения и ссылку на родительское окружение.

2. **Область видимости**:
    - **Глобальная**: доступ из любой части программы.
    - **Локальная**: доступ только внутри функции.
    - **Блочная**: доступ только внутри блока `{}`.

3. **Замыкания**:
    - Позволяют функции запоминать лексическое окружение.

4. **`var`, `let`, `const`**:
    - Используйте `let` и `const` для лучшей читаемости и избежания ошибок.

Правильное понимание области видимости и лексического окружения помогает писать более чистый, модульный и безопасный код.

--- 
